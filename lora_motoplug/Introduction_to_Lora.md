# Introduction to Lora

LoRa stands for Long Range Radio.
It is a modulation format that can be generated by Semtech parts, including the
SX1272 and SX1276 transceiver chips. This modulation format is best described as
a “frequency modulated (FM) chirp.” Other modulation formats include frequency
shift keying (FSK), phase shift keying (PSK), etc. It is important to remember
when asking “What is LoRa,” that LoRa itself does not describe system functionality
above the physical (RF medium) layer.

The LoRa protocol is a physical layer (PHY- OSI Layer 1) wireless component.

Semtech acquired the LoRa wireless technology through its acquisition of Cycleo
SAS of Grenoble, France for $5M in 2012. 

There are different frequency bands defined in US (902 to 928 MHz), EU (863 to 870 MHz),
China (779 to 787 MHz) and other regions to be used in LoRa wireless technology
based network. It is low power, long range and low data rate based technology.

LoRa network consists of gateways, network servers and end devices. The network
topology is star of stars. End devices are also known as motes and gateways are
known as base stations or concentrators in LoRa network system.

A Node is normally formed of a LoRa transceiver which is managed by a
microcontroller. The microcontroller can send management commands to the
transceiver to configure LoRa network settings, or to send and receive
application data which the transceiver is responsible for delivering to the
Network Server via the Gateways. Although Nodes can be listening at all times,
it is standard for the Node to work in a “call then listen” configuration,
whereby the Node will send data to the Network Server and then have short
windows afterwards where it listens for data coming back from the Network Server.
Gateways are fewer in number, and transfer data from the Nodes back to the
Network Server using standard IP connections. A LoRa solution therefore follows
a “star of star” topology, where multiple Nodes talk to one or more gateways,
which in turn talk back to a single Network Server. Gateways perform no security
functionality themselves, but merely act as a conduit to relay data between Nodes
and Network Server.

End devices and Gateways are connected wirelessly using ISM bands specified with
single hop. Gateways and network servers are connected using IP backhaul connections.

Communication between end devices and gateways are carried at different channels
and different data rates. LoRa supports adaptive data rate from 0.3 Kbps to 50 Kbps.

When processing a LoRa message, additional processing gain is achieved due to
the modem’s ability to filter on the constant ramp chirp signal. This is how high
sensitivity is achieved. In order to achieve “lock” to the LoRa signal, a long
“constant chirp” preamble is transmitted. This is really the power of LoRa, that
an inexpensive chip with a cheap crystal, can achieve very high sensitivity.

This preamble can be set as a variable number of “symbols,” which are just the
number of chirps. As you might imagine, there is no selectivity between a
preamble from one LoRa transmitter vs. another. If there is a constant chirp at
the right frequency and at the right chirp rate, a LoRa demodulator will listen
to it, whether its from the intended system or not.

Once a LoRa modem has “locked” on to the preamble signal, the end of the
preamble is signaled by the “reverse chirp”.

Then the data transmission begins, which has a series of “symbols” that function
much like M-ARY FSK symbols, but instead happen on a chirp.

Another powerful feature of LoRa is the ability to demodulate several “orthogonal”
or simultaneous signals at the same frequency, assuming they have different
chirp rates. In the datasheet, LoRa chirp rates are called “spreading factors,”
with higher spreading factors denoting slower chirps. This function is supported
by the SX1301 chip from Semtech.

Building a LoRa network or system requires a tremendous amount of development.
Going from LoRa to a functioning wireless system, is analogous to going from
having a BPSK radio chip to having a WiFi network. The OSI layer 2 and above
functions of large networks that include gateways, repeaters, addressing,
adaptive data rates, message retries, message acknowledgements, and high capacity
OFDM downlink signals are the function of systems like LoRaWAN and Symphony Link.

# Joining a Node to a LoRa network
The LoRaWAN protocol provides both signing and encryption for parts of LoRaWAN
packets. These are performed using symmetric keys known both to the Node and to
the Network Server (and potentially to Application Servers located behind the
Network server depending on requirements) and are distributed in one of two ways
depending on how a Node joins the network.

## Over-The-Air-Activation (OTAA)
The first method by which Nodes are allowed to join a LoRa network is through
OTAA. Here each Node is deployed with a unique 128-bit app key (AppKey) which is
used when the Node sends a join-request message. The message is not encrypted,
but is signed using this AppKey. The Node sends the join-request message
including its unique AppEUI and DevEUI values plus a DevNonce which should be a
randomly generated two byte value. The AppEUI should be unique to the owner of
the device. The DevEUI should be a globally unique identifier for the device.

The server should check the values and then re-calculate the MIC with the AppKey.
If valid, the server may respond with a join-accept message within the receive
windows of the Node. The Network server generates its own nonce value (AppNonce)
and calculate the Node’s two new 128-bit keys: the app session key (AppSKey),
and the network session key (NwkSKey). These are calculated based on the values
sent to it in the join-request message.

## Activation by Personalisation (ABP)
ABP differs from OTAA as the Nodes are shipped with the DevAddr and both session
keys (NwkSKey and AppSKey), which should be unique to the Node. As the Nodes
already have the information and keys they need, they can begin communicating
with the Network Server without the need for join messages.


# End device classes
LoRaWAN has several different classes of end-point devices to address the
different needs reflected in the wide range of applications:

Bi-directional end-devices (Class A): End-devices of Class A allow for
bi-directional communications whereby each end-device's uplink transmission is
followed by two short downlink receive windows. The transmission slot scheduled
by the end-device is based on its own communication needs with a small variation
based on a random time basis (ALOHA-type of protocol). This Class A operation is
the lowest power end-device system for applications that only require downlink
communication from the server shortly after the end-device has sent an uplink
transmission. Downlink communications from the server at any other time will
have to wait until the next scheduled uplink.

Bi-directional end-devices with scheduled receive slots (Class B): In addition
to the Class A random receive windows, Class B devices open extra receive
windows at scheduled times. In order for the End-device to open its receive
window at the scheduled time it receives a time synchronized Beacon from the
gateway. This allows the server to know when the end-device is listening.

Bi-directional end-devices with maximal receive slots (Class C): End-devices of
Class C have nearly continuously open receive windows, only closed when
transmitting.




# Glossary

ADR: Adaptive Data Rate

API: Application Programming Interface

Application Key (AppSKey): The optional 128-bit key used to encrypt the payload
of the messages.

Application Server (AS) Routing Profile: The routing information defining how
sensor data is routed to an application back-end connected to the core network
platform.

Long Range Receiver (LRR) Base Station: The equipment implementing one or more
radio transceivers complying with the LoRaWAN network PHY and MAC layer
specification. The LRR operates under the control of the LRC.

Connectivity Plan: The connectivity plan defines the networking features (e.g. confirmed
messages, downlink traffic), the traffic policy parameters (token bucket
regulators for uplink and downlink traffic) and the associated activation
and recurring fee associated to a given device.

Device An appliance identified by its globally unique IEEE EUI-64 identifier that is
able to initiate uplink traffic to, or receive downlink traffic from, one or
more Application Server through the LPWA network infrastructure.

EUI ID A globally unique 64 bit identifier assigned according to the IEEE EUI-64
guidelines.
GUI Graphical User Interface

LoRa Long Range and low energy radio RF technology developed by Semtech.
LoRa® is a registered trademark by Semtech Corporation.

Long Range Controller (LRC):
The LPWA core network component implementing the cloud based MAC
layer and acting as a mediation function between connected devices and
Application Servers.

Network Key (NwkSKey):
The 128-bit key used by the LPWA network to verify the authenticity and
integrity of each message transmitted through the system.

NOC Network Operation Center

OSS: Operations Support System

SNR: Signal to Noise Ratio

LPWAN: Low Power Wide Area networks

TDoA Time Difference on Arrival is a wireless location technology that relies on
sensitive receivers that are typically located at basestations to determine
the location of a device.

MAC layer: Medium access control or media access control (MAC) layer is the lower
sublayer of the data link layer (layer 2) of the seven-layer OSI model.
ISM band: Industrial, Scientific and Medical usages dedicated licence-free frequency
spectrum.

MQTT: ISO standard (ISO/IEC PRF 20922) publish-suscribe based "light weight"
messaging protocol for use on top of the TCP/IP protocol.


## References
LoRaWAN101.pdf --very good introductory pdf

LORAWAN_vs_SYMPHONY_LINK.pdf -- Goes a bit deeper about the LORAWAN protocol and
the rival SYMPHONY_LINK.

Nick_Hunn_LoRa-vs-LTE-M-vs-SigFox.pdf --Interesting, academic mostly comparisson
and a forecast.

LoRaWAN Specification.pdf -- The Lorawan specs.

iC880A_QuickStartGuide.pdf -- How to create your own gateway using the iC880A as
the basic component. Very good reading to get a grasp of how a gateway works.
Laird's gateway is based on this module too.

Here is a link for a gateway scanner:
https://github.com/Lora-net/lora_gateway/tree/master/util_spectral_scan
This scanner runs on top of the open source Lora forwading packet.












